# Story 1.3: whisper-agent-sequential

## Status
Draft

## Story
**Como** desenvolvedor,\
**Quero** implementar o `whisper_agent` como um `SequentialAgent` no Google ADK que recebe um caminho de mídia e produz a transcrição localmente,\
**Para que** o orquestrador disponha de texto confiável sem depender de serviços externos.

## Acceptance Criteria
1. O `whisper_agent` é implementado como `SequentialAgent` dentro de `packages/agents/whisper_agent/`, seguindo a estrutura de agentes prevista. [Fonte: architecture/estrutura-de-projeto.md#estrutura-de-projeto]
2. O agente utiliza `whisper-timestamped` com FFmpeg local para gerar transcrições, respeitando dependências do ambiente. [Fonte: architecture/detalhes-da-pilha-tecnologica.md#tecnologias-centrais; architecture/ambiente-de-desenvolvimento.md#pre-requisitos]
3. A transcrição gerada é disponibilizada ao orquestrador e armazenada em artefato local (arquivo ou memória) com metadados mínimos, deixando preparada a interface para persistência em banco no Épico 2. [Fonte: architecture/padroes-inovadores.md#loop-de-sintese-de-manuais; refs/adk_training-main/docs/docs/08_state_memory.md#session-state]
4. O agente retorna texto estruturado ao orquestrador, publicando eventos de progresso (`transcribing`, `transcription_ready`) e registrando logs obrigatórios. [Fonte: architecture/padroes-inovadores.md#loop-de-sintese-de-manuais; architecture/regras-de-consistencia.md#regras-de-consistencia]

## Tasks / Subtasks
- [ ] Criar classe `SequentialAgent` em `packages/agents/whisper_agent/agent.py` com ciclo de execução ADK. [Fonte: architecture/estrutura-de-projeto.md#estrutura-de-projeto]
- [ ] Configurar dependências Whisper (FFmpeg, `whisper-timestamped`) e validações de caminho de mídia. [Fonte: architecture/ambiente-de-desenvolvimento.md#pre-requisitos]
- [ ] Implementar camada de repositório que armazena o resultado em arquivo temporário ou memória, expondo interface compatível com futura persistência em `transcripts`. [Fonte: architecture/arquitetura-de-dados.md#modelo-relacional]
- [ ] Emitir eventos ADK/SSE (`transcribing`, `transcription_ready`) e logs estruturados. [Fonte: architecture/padroes-inovadores.md#loop-de-sintese-de-manuais]
- [ ] Implementar testes unitários em `tests/unit/agents/test_whisper_agent.py` cobrindo erros e sucesso. [Fonte: architecture/detalhes-da-pilha-tecnologica.md#tecnologias-centrais]
- [ ] Documentar instruções de uso no README local do agente para manter auditoria. [Fonte: architecture/padroes-de-implementacao-anti-conflito.md#padroes-de-implementacao-anti-conflito]

## Dev Notes
### Previous Story Insights
O WorkflowAgent (História 1.2) depende deste agente como ferramenta; garantir interface clara para integração. [Fonte: docs/stories/1.2.aido-orchestrator-workflow-agent.md]

### Data Models
- Interface alinhada a `transcripts` para futura persistência (id, idioma, status), mas no Épico 1 basta registrar recursos locais e retornar o texto ao orquestrador. [Fonte: architecture/arquitetura-de-dados.md#modelo-relacional; refs/adk_training-main/docs/docs/08_state_memory.md#session-state]

### API Specifications
- Nenhum endpoint HTTP dedicado; o agente é exposto como ferramenta interna do orquestrador. [Fonte: architecture/padroes-inovadores.md#loop-de-sintese-de-manuais]

### Component Specifications
- Implementação localizada em `packages/agents/whisper_agent/`, com assets compartilhados em `packages/agents/shared/`. [Fonte: architecture/estrutura-de-projeto.md#estrutura-de-projeto]
- Uso de `FileArtifactService` para gerenciar uploads temporários se necessário. [Fonte: architecture/padroes-inovadores.md#sincronizacao-de-artefatos-sensiveis]

### File Locations
- Agente principal: `packages/agents/whisper_agent/agent.py`. [Fonte: architecture/estrutura-de-projeto.md#estrutura-de-projeto]
- Repositório local de transcrições: `packages/agents/whisper_agent/storage.py` (sugerido) com possibilidade de evolução para banco. [Fonte: architecture/estrutura-de-projeto.md#estrutura-de-projeto]

### Testing
- Executar `pytest` para os testes unitários e fixtures de mídia em `tests/unit/`. [Fonte: architecture/detalhes-da-pilha-tecnologica.md#tecnologias-centrais]
- Validar performance com arquivos de exemplo (<10 min) garantindo tempo total <5 min. [Fonte: architecture/consideracoes-de-performance.md#consideracoes-de-performance]

### Technical Constraints
- Execução 100% local, sem upload externo; respeitar políticas de segurança e armazenamento em `data/uploads/`. [Fonte: architecture/arquitetura-de-seguranca.md#arquitetura-de-seguranca; architecture/padroes-inovadores.md#sincronizacao-de-artefatos-sensiveis]
- Manter cache de transcrições reutilizável para reduzir tempo de processamento. [Fonte: architecture/consideracoes-de-performance.md#consideracoes-de-performance]

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-10-31 | 1.0 | Rascunho inicial | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

